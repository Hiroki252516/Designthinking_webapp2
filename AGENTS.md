# AGENTS

## 目的
- ルーレット画面に遷移して抽選が行われるタイミングで、当たり確率を **25%** にする。
- **他の機能・仕様は一切変更しない**。

## 重要な制約
- フロントの表示/演出/文言/画面遷移は変更しない。
- APIのレスポンス形式・メッセージ・クーポン発行/再表示/引換ロジックは変更しない。
- 既存の「当選済み/引換済みは同一クーポンを再表示する」挙動を維持する。

## 変更ポイント（実装者向けメモ）
- `backend/main.py` の `/api/play` が当落を決めている。
- 現状は `VALID_OUTCOME = "win"` を前提に固定当選になっているため、**25%抽選**に変更する。
- `lid_codes.outcome` は `NOT NULL` なので、未抽選状態は `"pending"` などのプレースホルダを使う（スキーマ変更は避ける）。
- 抽選は **初回プレイ時のみ** 行い、結果はDBに保存して以後は同じ結果を返す（既存挙動を崩さない）。
- 25% は `secrets.randbelow(4) == 0` のように実装してよい。
- `init_db()` が起動時に outcome を固定で上書きしている点に注意（ランダム結果を潰さない）。

## 期待される挙動
- 有効コードの初回プレイ時：25%で `status=win`、75%で `status=lose`。
- 2回目以降：前回の結果を維持（当選済みなら同一クーポン再表示、ハズレならハズレ）。
- 無効コードや通信エラー等の挙動は現状維持。
